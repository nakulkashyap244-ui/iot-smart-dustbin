<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Smart Dustbin Dashboard</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f5f5f5;
            margin: 0;
            padding: 40px;
        }
        h1 {
            margin-bottom: 30px;
        }
        .card {
            background: #fff;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            max-width: 400px;
        }
        .label {
            font-size: 16px;
            margin-bottom: 8px;
        }
        .value {
            font-size: 22px;
            font-weight: bold;
            margin-bottom: 16px;
        }
        .progress {
            width: 100%;
            height: 20px;
            border-radius: 10px;
            background: #eee;
            overflow: hidden;
        }
        .bar {
            height: 100%;
            width: 0%;
            background: #4caf50;
            transition: width 0.4s ease, background 0.4s ease;
        }
        .status {
            margin-top: 10px;
            font-size: 14px;
            color: #555;
        }
        .status.critical {
            color: #c62828;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>Smart Dustbin Dashboard</h1>

    <div class="card">
        <div class="label">Fill Level</div>
        <div id="fillText" class="value">0%</div>

        <div class="progress">
            <div id="fillBar" class="bar"></div>
        </div>

        <div id="statusText" class="status">Status: Normal</div>
    </div>

    <script>
        let alerted = false; // taaki FULL ka popup bar‑bar na aaye

        async function loadData() {
            try {
                const res = await fetch('/data');
                const json = await res.json();
                const fill = Number(json.fill ?? 0);

                const fillText = document.getElementById('fillText');
                const fillBar  = document.getElementById('fillBar');
                const status   = document.getElementById('statusText');

                fillText.innerText = fill + '%';
                fillBar.style.width = Math.min(fill, 100) + '%';

                // ---- Status logic ----
                if (fill < 50) {
                    // Normal
                    fillBar.style.background = '#4caf50'; // green
                    status.innerText = 'Status: Normal';
                    status.classList.remove('critical');
                    alerted = false;
                } else if (fill < 80) {
                    // Getting full
                    fillBar.style.background = '#ffb300'; // yellow
                    status.innerText = 'Status: Getting Full';
                    status.classList.remove('critical');
                    alerted = false;
                } else if (fill < 100) {
                    // 80–99 : Almost full (no popup)
                    fillBar.style.background = '#e53935'; // red
                    status.innerText = 'Status: Almost Full';
                    status.classList.add('critical');
                    alerted = false;
                } else {
                    // 100 ya usse zyada → FULL + popup
                    fillBar.style.background = '#b71c1c';
                    status.innerText = 'Status: FULL!';
                    status.classList.add('critical');

                    if (!alerted) {
                        alert('Dustbin is FULL! Please empty it.');
                        alerted = true;
                    }
                }
            } catch (e) {
                console.error(e);
            }
        }

        loadData();                  // page load pe
        setInterval(loadData, 2000); // har 2 sec me update
    </script>
</body>
</html>
